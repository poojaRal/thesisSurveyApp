!function(){"use strict";angular.module("surveyApp").controller("surveyController",["$scope","$timeout","$location","activeData",function(e,n,t,o){e.title="Survey",e.questions=[],e.questionCounter=0,e.answers=[],e.selectedAnswer="",e.bodyPainAnswer={location:"",intensity:""},e.surveyID="",e.answeredCounter=0,e.noPainRect,e.noPainCheck=!1,e.isAnswered=!1,e.$watch("selectedAnswer",function(n){if("multiChoiceSingleAnswer"===e.questions[e.questionCounter].questionType&&(""!==n&&void 0!==n&&(e.isAnswered=!0),e.isAnswered)){var t=e.questions[e.questionCounter].quesID,o=n,s=(new Date).getTime();e.saveAnswerToLocalStorage(t,o,s),e.nextDisabled=!1}}),e.$watch("bodyPainAnswer.location",function(){e.bodyPainAnswerWatcher()}),e.$watch("bodyPainAnswer.intensity",function(){e.bodyPainAnswerWatcher()}),e.bodyPainAnswerWatcher=function(){console.log("Inside bodyPainAnswerWatcher"),console.log(e.bodyPainAnswer.location),console.log(e.bodyPainAnswer.intensity);var t="No Answer"==e.bodyPainAnswer.location&&"0"==e.bodyPainAnswer.intensity,o="No Answer"!==e.bodyPainAnswer.location&&""!==e.bodyPainAnswer.location&&"0"!==e.bodyPainAnswer.intensity;if((t||o)&&(e.isAnswered=!0),e.isAnswered){n(function(){e.$apply(function(){e.nextDisabled=!1})},10);var s=e.questions[e.questionCounter].quesID,i='{"location":"'+e.bodyPainAnswer.location+'","intensity":"'+e.painIntensityValue+'"}',a=(new Date).getTime();e.saveAnswerToLocalStorage(s,i,a)}else e.nextDisabled=!0},e.saveAnswerToLocalStorage=function(n,t,o){var s=e.surveyID;localStorage.setItem(s+":"+n,t),localStorage.setItem("ansTs:"+n,o)},e.checkFromLocalStorage=function(n){var t=e.surveyID;return null!==localStorage.getItem(t+":"+n)?localStorage.getItem(t+":"+n):"not set"},e.controllerInit=function(){e.prevDisabled=!0,e.nextDisabled=!0,""===o.getSurveyName()&&(o.setSurveyID(localStorage.getItem("reloadBackupSurveyID")),o.setSurveyName(localStorage.getItem("reloadBackupSurveyName")),o.setSurveyQuestions(JSON.parse(localStorage.getItem("reloadBackupSurveyQuestions")))),e.title=o.getSurveyName(),e.questions=o.getSurveyQuestions(),e.surveyID=o.getSurveyID(),console.log(e.questions),0===e.questionCounter&&($("#prev").hide(),e.prevDisabled=!0),e.populateQuestions();for(var n=e.sliderElements.length-1;n>=0;n--)document.getElementById(e.sliderElements[n]).addEventListener("click",e.onSliderElementClick);document.getElementById("noPainRect").addEventListener("click",e.noPainRectClick)},e.setMood=function(n){switch(e.isAnswered=!1,e.noPainCheck=!1,n){case 0:e.bodyPainAnswer.location="Sad";break;case 1:e.bodyPainAnswer.location="Happy";break;case 2:e.bodyPainAnswer.location="Neutral";break;case 3:e.bodyPainAnswer.location="Angry"}document.getElementById("noPainRect").style.fill="none"},e.onSliderElementClick=function(t){e.isAnswered=!1,n(function(){e.$apply(function(){e.nextDisabled=!0})},10);var o=t.target.id,s=parseInt(o.substr(o.length-1));e.painIntensityValue=s+1;for(var i=0;i<e.sliderElements.length;i++)s>=i?document.getElementById(e.sliderElements[i]).style.fill="#000000":document.getElementById(e.sliderElements[i]).style.fill="none";e.bodyPainAnswer.intensity=e.painIntensityValue,e.noPainCheck&&(e.noPainCheck=!1,document.getElementById("noPainRect").style.fill="none",e.bodyPainAnswer.location="")},e.noPainRectClick=function(){e.isAnswered=!1,console.log(e.noPainCheck),n(function(){e.$apply(function(){e.nextDisabled=!0})},10),e.noPainCheck?(this.style.fill="none",e.noPainCheck=!1,e.painIntensityValue=0,e.bodyPainAnswer.intensity=e.painIntensityValue,e.bodyPainAnswer.location=""):(this.style.fill="#000000",e.noPainCheck=!0,e.painIntensityValue=0,e.bodyPainAnswer.location="No Answer",e.bodyPainAnswer.intensity=e.painIntensityValue);for(var t=0;t<e.sliderElements.length;t++)document.getElementById(e.sliderElements[t]).style.fill="none"},e.populateQuestions=function(){(0===e.questions[e.questionCounter]||0===e.questions[e.questionCounter].answerOptions)&&e.changePage("/error/"+e.questionCounter),console.log(e.questions[e.questionCounter]);var n=e.questions[e.questionCounter].questionText;e.question=n,"multiChoiceSingleAnswer"===e.questions[e.questionCounter].questionType?($("#optionsTwo").hide(),$("#optionsThree").hide(),$("#optionsOne").show()):"multiChoiceMultipleCorrect"===e.questions[e.questionCounter].questionType?($("#optionsOne").hide(),$("#optionsTwo").hide(),$("#optionsThree").show()):"bodyPain"===e.questions[e.questionCounter].questionType&&($("#optionsOne").hide(),$("#optionsThree").hide(),$("#optionsTwo").show(),e.bodyPainAnswerWatcher()),e.populateAnswers()},e.changePage=function(e){t.path(e)},e.populateAnswers=function(){e.answers=[];var t=e.checkFromLocalStorage(e.questions[e.questionCounter].quesID);console.log("Answers length:"+e.answers.length),angular.forEach(e.questions[e.questionCounter].answerOptions,function(o,s){e.answers.push(o),"not set"!==t&&(console.log(t),parseInt(t)===parseInt(o.answerID)&&(console.log("here "+o.answerID),n(function(){e.$apply(function(){e.selectedAnswer=o.answerID})},10)))})},e.goPrev=function(){var n=e.questionCounter;e.questionCounter--,0===e.questionCounter&&($("#prev").hide(),e.prevDisabled=!0,e.nextDisabled=!0);var t=(new Date).getTime();localStorage.setItem("prev:"+e.questions[n].quesID,t),e.populateQuestions(),e.isAnswered=!1},e.goNext=function(){var n=e.questionCounter,t=(new Date).getTime();e.questionCounter===e.questions.length-1?(localStorage.setItem("next:"+e.questions[n].quesID,t),e.changePage("/surveyEnd")):(e.questionCounter++,e.questionCounter>0&&(e.prevDisabled=!1),e.questionCounter===e.questions.length-1&&(e.nextDisabled=!0),""===e.selectedAnswer&&(e.nextDisabled=!0),localStorage.setItem("next:"+e.questions[n].quesID,t),e.populateQuestions(),e.selectedAnswer="",e.nextDisabled=!0,1===e.questionCounter&&$("#prev").show(),e.isAnswered=!1)},e.changePage=function(e){t.path(e)},e.getAnswered=function(){var n=e.questionCounter+1;return n},e.getTotal=function(){return e.questions.length},e.getPercentage=function(){return e.getAnswered()/e.getTotal()*100},e.parts=["imgHappy","imgSad"],e.partNames=["Happy","Sad"],e.partClicked="No Part Selected",e.painIntensityValue=0,e.position,e.lastSelectedPart,e.noPartSelected=!0,e.sliderElements=["sliderElem0","sliderElem1","sliderElem2","sliderElem3","sliderElem4","sliderElem5","sliderElem6","sliderElem7","sliderElem8","sliderElem9"],e.controllerInit(),window.onbeforeunload=function(e){if("#/survey"===window.location.hash){localStorage.setItem("reloadBackupSurveyName",o.getSurveyName()),localStorage.setItem("reloadBackupSurveyQuestions",JSON.stringify(o.getSurveyQuestions())),localStorage.setItem("reloadBackupSurveyID",o.getSurveyID());var n="If you leave this page you will have to start over again, are you sure you want to leave?";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=n),n}},e.$on("$destroy",function(){delete window.onbeforeunload})}])}();