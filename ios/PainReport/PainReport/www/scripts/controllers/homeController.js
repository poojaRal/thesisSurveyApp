!function(){"use strict";angular.module("surveyApp").controller("homeController",["$rootScope","$scope","$location","serviceCall","activeData",function(e,r,s,t,o){r.title="Home",r.nextDueSurveyID="";var a=!1;r.controllerInit=function(){if(o.setSurveyCompleted(!1),localStorage.surveyInProgress||(localStorage.surveyInProgress=-1),localStorage.surveyAppPin)if(localStorage.surveyAppServerSettings){var e=localStorage.surveyAppPin,s='{"userPIN":"'+e+'"}',a=new t("check_surveys","GET");$("#loader").modal("show"),"remote"==localStorage.dataSource&&a.call(s,r.surveyIDsuccess,r.serviceError),"local"==localStorage.dataSource&&a.call(s,r.surveyIDsuccess,r.serviceError,"json/getSurveyID.json")}else r.surveyMessage="You don't have your server settings setup.";else localStorage.surveyAppServerSettings?r.surveyMessage="You don't have your PIN setup.":r.surveyMessage="You don't have your PIN and server settings setup."},r.surveyIDsuccess=function(e,s,t,u){if($("#loader").modal("hide"),"Success"==e.message&&0!==e.surveys.length){for(var n=0,l="9999-12-31 11:59:59",v=0;v<e.surveys.length;v++){if(a=e.surveys[v].okayToStart){n=v;break}e.surveys[v].nextDueAt<l&&(l=e.surveys[v].nextDueAt,n=v)}a=e.surveys[n].okayToStart;var c=e.surveys[n].nextDueAt;r.nextDueSurveyID=e.surveys[n].surveyInstanceID,r.nextDueSurveyTitle=e.surveys[n].surveyTitle,console.log(r.nextDueSurveyID),o.setSurveyID(r.nextDueSurveyID);var y=new Date(c);console.log(y);var i=y.getDate(),g=y.getMonth()+1,S=y.getFullYear();10>i&&(i="0"+i),10>g&&(g="0"+g),y=g+"/"+i+"/"+S,console.log(y),a&&$("#startSurvey").removeClass("disabled"),-1!==localStorage.surveyInProgress&&parseInt(localStorage.surveyInProgress)===r.nextDueSurveyID?r.surveyMessage="You have a "+r.nextDueSurveyTitle+" in progress, due on "+y+". To begin survey, please click on the Start Survey button.":a?r.surveyMessage="You have a "+r.nextDueSurveyTitle+" due on "+y+". To begin survey, please click on the Start Survey button.":r.surveyMessage="You have a "+r.nextDueSurveyTitle+" due on "+y+". "}else"You have no active surveys"==e.message?r.surveyMessage="You have no surveys due. Please check in again later.":"Your PIN is not active"==e.message?r.surveyMessage="Your PIN is not active. Please contact the administrator.":"The PIN is invalid"==e.message?r.surveyMessage="Your PIN is invalid. Please contact the administrator.":"Unexpected Error"==e.message?r.surveyMessage="Unexpected Error. Please contact the administrator.":0===e.surveys.length&&(r.surveyMessage="You don't have any surveys due at this time. Please check again later.")},r.serviceError=function(e,s,t,a){$("#loader").modal("hide"),console.log(s),console.log(o.getError()),"offline"===o.getError()?r.surveyMessage="Unable to fetch data. Please check internet connectivity.":"internalServerError"===o.getError()?r.surveyMessage="Unable to fetch data. There's a server error.":"notFound"===o.getError()?r.surveyMessage="Unable to fetch data. API not found on server. Incorrect route.":"unknownError"===o.getError()?r.surveyMessage="Unable to fetch data. Please check internet connectivity or contact administrator.":r.surveyMessage="Unable to fetch data. Please contact administrator."},r.getSurvey=function(){if(a){console.log(r.nextDueSurveyID);var e='{"surveyInstanceID":'+r.nextDueSurveyID+"}";console.log(e),$("#loader").modal("show");var s=new t("get_survey","GET");"remote"==localStorage.dataSource&&s.call(e,r.getSurveySuccess,r.serviceError),"local"==localStorage.dataSource&&s.call(e,r.getSurveySuccess,r.serviceError,"json/getSurvey.json")}},r.getSurveySuccess=function(e,s,t,a){$("#loader").modal("hide"),console.log(e),console.log(e.surveyName),o.setSurveyName(e.surveyName),o.setSurveyQuestions(e.questions),localStorage.surveyInProgress=r.nextDueSurveyID,localStorage.surveyStartedAt=(new Date).getTime(),r.changePage("/survey")},r.changePage=function(e){s.path(e)},Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),r=(this.getMonth()+1).toString(),s=this.getDate().toString();return e+"-"+(r[1]?r:"0"+r[0])+"-"+(s[1]?s:"0"+s[0])},r.controllerInit()}])}();