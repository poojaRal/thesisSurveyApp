!function(){"use strict";angular.module("surveyApp").controller("settingsController",["$scope","$location","serviceCall",function(e,t,r){e.title="Settings",e.dataSource="remote",e.reminderTime=1,e.saveStateTime=4,e.protocolSettings="https",e.error={},e.error.message,e.initModels=function(){if(localStorage.surveyAppPin&&(e.pin=localStorage.surveyAppPin),localStorage.surveyAppServerSettings&&(e.serverSettings=localStorage.surveyAppServerSettings,e.serverSettings.indexOf("://")>-1)){var t=e.serverSettings.split("://",2);e.serverSettings=t[1]}localStorage.dataSource?e.dataSource=localStorage.dataSource:localStorage.dataSource=e.dataSource,localStorage.reminderTime?e.reminderTime=localStorage.reminderTime:localStorage.reminderTime=e.reminderTime,localStorage.saveStateTime?e.saveStateTime=localStorage.saveStateTime:localStorage.saveStateTime=e.saveStateTime,localStorage.protocolSettings?e.protocolSettings=localStorage.protocolSettings:localStorage.protocolSettings=e.protocolSettings;var o=new r("release_info","GET");o.call("{}",e.releaseInfoCallSuccess,e.releaseInfoCallError,"config.json")},e.changePage=function(e){t.path(e)},e.releaseInfoCallSuccess=function(e){console.log(e.config.release),$("#releaseInfo").text(e.config.release)},e.releaseInfoCallError=function(){console.log("Unable to get release number from local config.")},e.saveSettings=function(){var t;if(void 0!==e.pin){t=!1;var r=/^\d+$/;r.test(e.pin)?(e.error.message="",localStorage.surveyAppPin=e.pin,t=!0):e.error.message="PIN should contain numbers only."}if(void 0!==e.serverSettings&&(t=!1,e.serverSettings.indexOf("://")>-1?alert("The server address must be entered without http or https"):(e.serverSettings=e.protocolSettings+"://"+e.serverSettings,localStorage.surveyAppServerSettings=e.serverSettings,t=!0)),t){var o=e.getMobileOperatingSystem();if("iOS"===o){var a=window.navigator.standalone,i=window.navigator.userAgent.toLowerCase(),n=/safari/.test(i);!a&&n||(i.indexOf("painreport")>-1?window.location="jsHandler://updateSettings?serverAddress="+localStorage.surveyAppServerSettings+"&pin="+localStorage.surveyAppPin+"&intervalTime="+localStorage.reminderTime+"&stateTime="+localStorage.saveStateTime:a||n||(window.location="jsHandler://updateSettings?serverAddress="+localStorage.surveyAppServerSettings+"&pin="+localStorage.surveyAppPin+"&intervalTime="+localStorage.reminderTime+"&stateTime="+localStorage.saveStateTime))}else"Android"===o&&e.testNativeAndroidAppUA()&&jsHandler.updateSettings(localStorage.surveyAppServerSettings,localStorage.surveyAppPin,localStorage.reminderTime,localStorage.saveStateTime);e.changePage("/home")}},e.testNativeAndroidAppUA=function(){return/painreport/.test(navigator.userAgent)},e.getMobileOperatingSystem=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.match(/iPad/i)||e.match(/iPhone/i)||e.match(/iPod/i)?"iOS":e.match(/Android/i)?"Android":"unknown"},e.saveAdvancedSettings=function(){console.log(e.dataSource),console.log(e.reminderTime),console.log(e.saveStateTime),console.log(e.protocolSettings),localStorage.dataSource=e.dataSource,localStorage.reminderTime=e.reminderTime,localStorage.saveStateTime=e.saveStateTime,localStorage.protocolSettings=e.protocolSettings,$("#advancedSettings").modal("hide")},e.initModels()}])}();