!function(){"use strict";angular.module("surveyApp").controller("surveyController",["$scope","$timeout","$location","activeData",function(e,t,n,o){e.title="Survey",e.questions=[],e.questionCounter=0,e.answers=[],e.selectedAnswer="",e.bodyPainAnswer={location:"",intensity:""},e.surveyID="",e.answeredCounter=0,e.noPainRect,e.noPainCheck=!1,e.isAnswered=!1,e.$watch("selectedAnswer",function(t){if("multiChoiceSingleAnswer"===e.questions[e.questionCounter].questionType&&(""!==t&&void 0!==t&&(e.isAnswered=!0),e.isAnswered)){var n=e.questions[e.questionCounter].quesID,o=t;console.log(o),e.saveAnswerToLocalStorage(n,o),e.nextDisabled=!1}}),e.$watch("partClicked",function(){e.bodyPainAnswer.location=e.partClicked,e.bodyPainAnswerWatcher()}),e.$watch("painIntensityValue",function(){e.bodyPainAnswer.intensity=e.painIntensityValue,e.bodyPainAnswerWatcher()}),e.bodyPainAnswerWatcher=function(){if(console.log(e.bodyPainAnswer),console.log(e.noPainCheck),console.log(e.painIntensityValue),console.log(e.lastSelectedPart),("No Part Selected"!==e.lastSelectedPart&&!angular.isUndefined(e.lastSelectedPart)&&""!==e.lastSelectedPart&&0!==e.painIntensityValue||e.noPainCheck&&0===e.painIntensityValue)&&(e.isAnswered=!0),e.isAnswered){t(function(){e.$apply(function(){e.nextDisabled=!1})},10);var n=e.questions[e.questionCounter].quesID,o="";console.log(e.partClicked),console.log(document.getElementById("bodyPartText").textContent);var a=document.getElementById("bodyPartText").textContent;switch(a){case"Head Front":o="front head";break;case"Chest":o="front chest";break;case"Right Hand Front":o="front right arm";break;case"Abdomen":o="front abdominal";break;case"Left Hand Front":o="front left arm";break;case"Right Leg Front":o="front right leg";break;case"Left Leg Front":o="front left leg";break;case"Head Back":o="back head";break;case"Upper Back":o="back";break;case"Left Leg Back":o="back left leg";break;case"Right Leg Back":o="back right leg";break;case"Right Hand Back":o="back right arm";break;case"Left Hand Back":o="back left arm";break;case"Lower Back":o="lower back"}console.log(o),("No Pain"===e.bodyPainAnswer.location||e.noPainCheck)&&(o="No Pain");var l='{"location":"'+o+'","intensity":"'+e.painIntensityValue+'"}';e.saveAnswerToLocalStorage(n,l)}else e.nextDisabled=!0},e.saveAnswerToLocalStorage=function(t,n){var o=e.surveyID;localStorage.setItem(o+":"+t,n)},e.checkFromLocalStorage=function(t){var n=e.surveyID;return null!==localStorage.getItem(n+":"+t)?localStorage.getItem(n+":"+t):"not set"},e.controllerInit=function(){e.prevDisabled=!0,e.nextDisabled=!0,""===o.getSurveyName()&&(o.setSurveyID(localStorage.getItem("reloadBackupSurveyID")),o.setSurveyName(localStorage.getItem("reloadBackupSurveyName")),o.setSurveyQuestions(JSON.parse(localStorage.getItem("reloadBackupSurveyQuestions")))),e.title=o.getSurveyName(),e.questions=o.getSurveyQuestions(),e.surveyID=o.getSurveyID(),console.log(e.questions),0===e.questionCounter&&($("#prev").hide(),e.prevDisabled=!0),e.populateQuestions();for(var t=e.sliderElements.length-1;t>=0;t--)document.getElementById(e.sliderElements[t]).addEventListener("click",e.onSliderElementClick);for(t=e.parts.length-1;t>=0;t--)document.getElementById(e.parts[t]).addEventListener("click",e.onBodyPartClick);document.getElementById("noPainRect").addEventListener("click",e.noPainRectClick)},e.onSliderElementClick=function(n){e.isAnswered=!1,t(function(){e.$apply(function(){e.nextDisabled=!0})},10);var o=n.target.id,a=parseInt(o.substr(o.length-1));e.painIntensityValue=a+1;for(var l=0;l<e.sliderElements.length;l++)a>=l?document.getElementById(e.sliderElements[l]).style.fill="#000000":document.getElementById(e.sliderElements[l]).style.fill="none";e.bodyPainAnswer.intensity=e.painIntensityValue,e.bodyPainAnswerWatcher(),e.noPainCheck&&(e.noPainCheck=!1,document.getElementById("noPainRect").style.fill="none",document.getElementById("bodyPartText").textContent="")},e.noPainRectClick=function(){e.isAnswered=!1,t(function(){e.$apply(function(){e.nextDisabled=!0})},10),e.noPainCheck?(this.style.fill="none",e.noPainCheck=!1,document.getElementById("bodyPartText").textContent="",e.painIntensityValue=0,e.bodyPainAnswer.intensity=e.painIntensityValue,e.bodyPainAnswerWatcher()):(this.style.fill="#000000",e.noPainCheck=!0,document.getElementById("bodyPartText").textContent="No Pain",e.painIntensityValue=0,e.bodyPainAnswer.location="No Pain",e.bodyPainAnswer.intensity=e.painIntensityValue,e.bodyPainAnswerWatcher(),null!==document.getElementById(e.lastSelectedPart)&&(console.log(document.getElementById(e.lastSelectedPart)),document.getElementById(e.lastSelectedPart).style.fill="#ecf0f1","headBack"==document.getElementById(e.lastSelectedPart).id&&(document.getElementById("headBack").style.fill="#6F6F6F")),e.lastSelectedPart="");for(var n=0;n<e.sliderElements.length;n++)document.getElementById(e.sliderElements[n]).style.fill="none"},e.populateQuestions=function(){(0===e.questions[e.questionCounter]||0===e.questions[e.questionCounter].answerOptions)&&e.changePage("/error/"+e.questionCounter),console.log(e.questions[e.questionCounter]);var t=e.questions[e.questionCounter].questionText;e.question=t,"multiChoiceSingleAnswer"===e.questions[e.questionCounter].questionType?($("#optionsTwo").hide(),$("#optionsThree").hide(),$("#optionsOne").show()):"multiChoiceMultipleCorrect"===e.questions[e.questionCounter].questionType?($("#optionsOne").hide(),$("#optionsTwo").hide(),$("#optionsThree").show()):"bodyPain"===e.questions[e.questionCounter].questionType&&($("#optionsOne").hide(),$("#optionsThree").hide(),$("#optionsTwo").show(),e.bodyPainAnswerWatcher(),e.checkForBodyPainAnswerStored()),e.populateAnswers()},e.changePage=function(e){n.path(e)},e.checkForBodyPainAnswerStored=function(){if(localStorage.getItem(e.surveyID+":"+e.questions[e.questionCounter].quesID)){var t=JSON.parse(localStorage.getItem(e.surveyID+":"+e.questions[e.questionCounter].quesID));if(console.log(t.location),console.log(t.intensity),"No Pain"===t.location)document.getElementById("noPainRect").style.fill="#000000",e.noPainCheck=!0,document.getElementById("bodyPartText").textContent="No Pain",e.painIntensityValue=0,e.bodyPainAnswer.location="No Pain",e.bodyPainAnswer.intensity=0,null!==document.getElementById(e.lastSelectedPart)&&(document.getElementById(e.lastSelectedPart).style.fill="#ecf0f1"),e.lastSelectedPart="";else{e.painIntensityValue=t.intensity,e.bodyPainAnswer.intensity=e.painIntensityValue;for(var n=e.painIntensityValue-1,o=0;o<e.sliderElements.length;o++)n>=o?document.getElementById(e.sliderElements[o]).style.fill="#000000":document.getElementById(e.sliderElements[o]).style.fill="none";switch(console.log(t.location),t.location){case"front head":document.getElementById("headFront").style.fill="#000000",e.lastSelectedPart="headFront",document.getElementById("bodyPartText").textContent="Head Front";break;case"front chest":document.getElementById("chest").style.fill="#000000",e.lastSelectedPart="chest",document.getElementById("bodyPartText").textContent="Chest";break;case"front right arm":document.getElementById("rightHandFront").style.fill="#000000",e.lastSelectedPart="rightHandFront",document.getElementById("bodyPartText").textContent="Right Hand Front";break;case"front abdominal":document.getElementById("abdomen").style.fill="#000000",e.lastSelectedPart="abdomen",document.getElementById("bodyPartText").textContent="Abdomen";break;case"front left arm":document.getElementById("leftHandFront").style.fill="#000000",e.lastSelectedPart="leftHandFront",document.getElementById("bodyPartText").textContent="Left Hand Front";break;case"front right leg":document.getElementById("rightLegFront").style.fill="#000000",e.lastSelectedPart="rightLegFront",document.getElementById("bodyPartText").textContent="Right Leg Front";break;case"front left leg":document.getElementById("leftLegFront").style.fill="#000000",e.lastSelectedPart="leftLegFront",document.getElementById("bodyPartText").textContent="Left Leg Front";break;case"back head":document.getElementById("headBack").style.fill="#000000",e.lastSelectedPart="headBack",document.getElementById("bodyPartText").textContent="Head Back";break;case"back":document.getElementById("upperBack").style.fill="#000000",e.lastSelectedPart="upperBack",document.getElementById("bodyPartText").textContent="Upper Back";break;case"back left leg":document.getElementById("leftLegBack").style.fill="#000000",e.lastSelectedPart="leftLegBack",document.getElementById("bodyPartText").textContent="Left Leg Back";break;case"back right leg":document.getElementById("rightLegBack").style.fill="#000000",e.lastSelectedPart="rightLegBack",document.getElementById("bodyPartText").textContent="Right Leg Back";break;case"back right arm":document.getElementById("rightHandBack").style.fill="#000000",e.lastSelectedPart="rightHandBack",document.getElementById("bodyPartText").textContent="Right Hand Back";break;case"back left arm":document.getElementById("leftHandBack").style.fill="#000000",e.lastSelectedPart="leftHandBack",document.getElementById("bodyPartText").textContent="Left Hand Back";break;case"lower back":document.getElementById("lowerBack").style.fill="#000000",e.lastSelectedPart="lowerBack",document.getElementById("bodyPartText").textContent="Lower Back"}}e.bodyPainAnswerWatcher()}},e.populateAnswers=function(){e.answers=[];var n=e.checkFromLocalStorage(e.questions[e.questionCounter].quesID);angular.forEach(e.questions[e.questionCounter].answerOptions,function(o,a){e.answers.push(o),"not set"!==n&&(console.log(n),parseInt(n)===parseInt(o.answerID)&&(console.log("here "+o.answerID),t(function(){e.$apply(function(){e.selectedAnswer=o.answerID})},10)))})},e.goPrev=function(){e.questionCounter--,0===e.questionCounter&&($("#prev").hide(),e.prevDisabled=!0,e.nextDisabled=!0),e.populateQuestions(),e.isAnswered=!1},e.goNext=function(){e.questionCounter===e.questions.length-1?e.changePage("/surveyEnd"):(e.questionCounter++,e.questionCounter>0&&(e.prevDisabled=!1),e.questionCounter===e.questions.length-1&&(e.nextDisabled=!0),""===e.selectedAnswer&&(e.nextDisabled=!0),e.populateQuestions(),e.selectedAnswer="",e.nextDisabled=!0,1===e.questionCounter&&$("#prev").show(),e.isAnswered=!1)},e.changePage=function(e){n.path(e)},e.getAnswered=function(){var t=e.questionCounter+1;return t},e.getTotal=function(){return e.questions.length},e.getPercentage=function(){return e.getAnswered()/e.getTotal()*100},e.parts=["headFront","chest","abdomen","rightHandFront","leftHandFront","rightLegFront","leftLegFront","headBack","upperBack","lowerBack","rightHandBack","leftHandBack","leftLegBack","rightLegBack"],e.partNames=["Head Front","Chest","Abdomen","Right Hand Front","Left Hand Front","Right Leg Front","Left Leg Front","Head Back","Upper Back","Lower Back","Right Hand Back","Left Hand Back","Left Leg Back","Right Leg Back"],e.partClicked="No Part Selected",e.painIntensityValue=0,e.position,e.lastSelectedPart,e.noPartSelected=!0,e.onBodyPartClick=function(){if(e.isAnswered=!1,t(function(){e.$apply(function(){e.nextDisabled=!0})},10),console.log(this.id),console.log(e.lastSelectedPart),this.id!=e.lastSelectedPart){0===e.painIntensityValue&&(e.noPainCheck=!1,document.getElementById("bodyPartText").textContent="",document.getElementById("noPainRect").style.fill="none",e.partClicked="No Part Selected");var n=e.parts.indexOf(this.id);this.style.fill="#000000",null!==document.getElementById(e.lastSelectedPart)&&("headBack"===e.lastSelectedPart?document.getElementById(e.lastSelectedPart).style.fill="#6f6f6f":document.getElementById(e.lastSelectedPart).style.fill="#ecf0f1"),e.lastSelectedPart=this.id,document.getElementById("bodyPartText").textContent=e.partNames[n],e.partClicked=e.lastSelectedPart,e.bodyPainAnswer.location=e.partClicked,e.bodyPainAnswerWatcher()}else"headBack"===this.id?this.style.fill="#6f6f6f":this.style.fill="#ecf0f1",e.lastSelectedPart=null,document.getElementById("bodyPartText").textContent=""},e.sliderElements=["sliderElem0","sliderElem1","sliderElem2","sliderElem3","sliderElem4","sliderElem5","sliderElem6","sliderElem7","sliderElem8","sliderElem9"],e.controllerInit(),window.onbeforeunload=function(e){if("#/survey"===window.location.hash){localStorage.setItem("reloadBackupSurveyName",o.getSurveyName()),localStorage.setItem("reloadBackupSurveyQuestions",JSON.stringify(o.getSurveyQuestions())),localStorage.setItem("reloadBackupSurveyID",o.getSurveyID());var t="If you leave this page you will have to start over again, are you sure you want to leave?";return"undefined"==typeof e&&(e=window.event),e&&(e.returnValue=t),t}},e.$on("$destroy",function(){delete window.onbeforeunload})}])}();